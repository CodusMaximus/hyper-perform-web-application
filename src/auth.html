<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>HyperPerform</title>
    <link rel="icon" type="image/gif" sizes="16x16" href="assets/img/app/profile/Logo2.png">


    <script src="../bower_components/jquery/dist/jquery.min.js"></script>
    <script src="../bower_components/bootstrap/dist/js/bootstrap.js"></script>
    <!--<script src="assets/js/login.js"></script>-->

    <link rel="stylesheet" href="../bower_components/bootstrap/dist/css/bootstrap.min.css" />
    <link rel="stylesheet" href="../bower_components/bootstrap-select/dist/css/bootstrap-select.css" />
    <link rel="stylesheet" href="../bower_components/bootstrap-switch/dist/css/bootstrap3/bootstrap-switch.css" />
    <link rel="stylesheet" href="../bower_components/bootstrap-tagsinput/dist/bootstrap-tagsinput.css" />
    <link rel="stylesheet" href="../bower_components/Ionicons/css/ionicons.css" />
    <link rel="stylesheet" href="../bower_components/font-awesome/css/font-awesome.css" />
    <link rel="stylesheet" href="../bower_components/angular-toastr/dist/angular-toastr.css" />
    <link rel="stylesheet" href="../bower_components/animate.css/animate.css" />
    <link rel="stylesheet" href="../bower_components/bootstrap/dist/css/bootstrap.css" />
    <link rel="stylesheet" href="../bower_components/bootstrap-select/dist/css/bootstrap-select.css" />
    <link rel="stylesheet" href="../bower_components/bootstrap-switch/dist/css/bootstrap3/bootstrap-switch.css" />
    <link rel="stylesheet" href="../bower_components/bootstrap-tagsinput/dist/bootstrap-tagsinput.css" />
    <link rel="stylesheet" href="../bower_components/jstree/dist/themes/default/style.css" />

    <!--<link href="assets/js/datatables/jquery.dataTables.min.css" rel="stylesheet" type="text/css" />-->
    <link href="assets/js/datatables/buttons.bootstrap.min.css" rel="stylesheet" type="text/css" />
    <link rel="stylesheet" href="app/main.css">
    <link rel="stylesheet" href="app/man.css">
    <script>
        function getCookie(cname) {
            var name = cname + "=";
            var ca = document.cookie.split(';');
            for(var i = 0; i <ca.length; i++) {
                var c = ca[i];
                while (c.charAt(0)==' ') {
                    c = c.substring(1);
                }
                if (c.indexOf(name) == 0) {
                    return c.substring(name.length,c.length);
                }
            }
            return "";
        }

        if (document.cookie != "" )
        {
            if (getCookie('hpkey') != "")
                window.location.href = "/user#/dashboard";
            if (getCookie('hpman') != "")
                window.location.href = "/man.html";
        }
    </script>

    <!--<script src="../bower_components/jquery/dist/jquery.js"></script>-->

    <!--<link href='https://fonts.googleapis.com/css?family=Roboto:400,100,100italic,300,300italic,400italic,500,500italic,700,700italic,900italic,900&subset=latin,greek,greek-ext,vietnamese,cyrillic-ext,latin-ext,cyrillic' rel='stylesheet' type='text/css'>-->


    <link rel="icon" type="image/png" sizes="96x96" href="assets/Logo2.png">

    <!-- build:css({.tmp/serve,src}) styles/vendor.css -->
    <!-- bower:css -->
    <!-- run `gulp inject` to automatically populate bower styles dependencies -->
    <!-- endbower -->
    <!-- endbuild -->

    <!-- build:css({.tmp/serve,src}) styles/auth.css -->
    <!-- inject:css -->
    <!-- css files will be automatically insert here -->
    <!-- endinject -->
    <!-- endbuild -->
    <style>
        /* The Modal (background) */
        .modallog {
            /*display: none; !* Hidden by default *!*/
            position: fixed; /* Stay in place */
            z-index: 1; /* Sit on top */
            padding-top: 100px; /* Location of the box */
            left: 0;
            top: 0;
            width: 100%; /* Full width */
            height: 100%; /* Full height */
            overflow: auto; /* Enable scroll if needed */
            background-color: rgb(0,0,0); /* Fallback color */
            background-color: rgba(0,0,0,0.4); /* Black w/ opacity */
        }

        /* Modal Content */
        .modal-logcontent {
            background-color: #fefefe;
            margin: auto;
            padding: 20px;
            border: 1px solid #888;
            width: 30%;
            text-align: center;
        }

        /* The Close Button */
        .closelog {
            color: #aaaaaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
        }
        .show{
            display: block !important;

        }

        .hide {
            display: none !important;
        }
        .closelog:hover,
        .closelog:focus {
            color: #000;
            text-decoration: none;
            cursor: pointer;
        }
    </style>
</head>
<body >
<main class="auth-main">

    <!-- The Modal -->
    <div id="myModal" class="modallog hidden">
        <!--<div class="modal-dialog">-->
        <!-- Modal content -->
        <div class="modal-logcontent">

                 <span class="closelog" onclick="close()">Ã—</span>
                             <p id="msg"> </p>

        </div>
    </div>

    <script>
        function close()
        {
            $("#myModal").toggleClass('show','hidden');
        }


    </script>


    <div id="forgotPass" class="modal" role="dialog">
        <div class="modal-dialog">

            <!-- Modal content-->
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                    <h4 class="modal-title">Forgot Password</h4>
                </div>
                <div class="modal-body">
                    <div class="row" >
                        <div class="row" id="valid">
                            <div class="col-lg-3 col-md-3 col-sm-3 col-xs-3"></div>
                            <div class="col-lg-5 col-md-5 col-sm-5 col-xs-5">
                                <!--<h2 class="text-center">Enter your Email <h2>-->
                                <input type="text" class="input-lg form-control" id="mail" placeholder="Your Email Address" style="border:0.5px solid darkgrey" data-toggle="popover" data-trigger="manual" auto-focus="true">
                            </div>
                        </div>
                            </div>
                    </div>

                <div class="modal-footer">
                    <button type="button" id="sendP" class="btn btn-primary" onclick="sendPass()"><i class="fa fa-ticket"></i>Verify</button>
                </div>
            </div>

        </div>
    </div>

    <!--<div class="modal-content" id="modal">-->
        <!--<div class="modal-header bg-success">-->
            <!--<i class="ion-checkmark modal-icon"></i><span>  </span>-->
        <!--</div>-->
        <!--<div class="modal-body text-center" id="msg"> </div>-->
        <!--<div class="modal-footer">-->
            <!--<button type="button" class="btn btn-success" > OK  </button>-->
        <!--</div>-->
    <!--</div>-->

    <div id="authblock" class="auth-block">
        <!--<div class="row">-->
            <!--<img class="col-lg-6 col-md-6" height="50px" src="assets/Logo2.png" alt="HyperPerform">-->
            <!--<h1 class="col-lg-6 col-md-6 col-sm-6 col-xs-6" id="hp">HyperPerform</h1>-->
        <!--</div>-->
        <div class="log-title" align="center">
            <img class="main-logo" src="assets/Logo2.png" height="50px" alt="Logo" style="display: inline;">
            <span id="hyper" style="color: #1F968B;"> Hyper</span><span id="perform">Perform</span>
        </div>
        <!--<a href="reg.html" class="auth-link">New to Blur Admin? Sign up!</a>-->
    <!-- <form -->
        <div class="form-horizontal formBox">
            <div class="form-group">
                <div class="row">
                    <div class="col-lg-10 col-md-10 col-sm-10 col-xs-10 form-el">
                        <input type="email" class="form-control input-md" value="" id="email" placeholder="Email">
                    </div>
                </div>
            </div>
            <div class="form-group">
                <div class="row">
                    <div class="col-lg-10 col-md-10 col-sm-10 col-xs-10 form-el">
                        <input type="password" class="form-control input-md" value="" id="password" placeholder="Password">
                    </div>
                </div>
            </div>
            <div class="form-group">
                <div class="col-lg-10 col-md-10 col-sm-10 col-xs-10 form-el" id="error">

                </div>
                <div class="col-sm-offset-2 col-lg-10 col-md-10 col-sm-10 col-xs-10 log-submit">
                    <button type="submit" id="login" class="btn btn-primary btn-auth" onclick="auth()">Login</button>
                    <a onclick="forgot()" class="forgot-pass">Forgot password?</a>
                </div>
            </div>
        </div>
        <script>


            function forgot()
            {
                $("#forgotPass").modal("show");
                $("#mail").focus();

            }

            $( "#authblock" ).keydown(function( event ) {
                if (event.which == 13) {
                auth();
                }
            });


                // Get the modal
//            var modal = document.getElementById('myModal');
//
//
//            // Get the <span> element that closes the modal
//            var span = document.getElementsByClassName("close")[0];
//
//
//            // When the user clicks on <span> (x), close the modal
//            span.onclick = function() {
//                modal.style.display = "none";
//            };
//
//            // When the user clicks anywhere outside of the modal, close it
//            window.onclick = function(event) {
//                if (event.target == modal) {
//                    modal.style.display = "none";
//                }
//            };
//            $("#modal").hide();

            function auth() {
                document.getElementById('login').innerHTML = "<i class='fa fa-spinner fa-pulse '></i>";
                var http = new XMLHttpRequest();
                var url = "http://localhost:8080/hyperperform-system-1.0-SNAPSHOT/rs/users/verifyDetails";
                var params = JSON.stringify({userEmail: document.getElementById('email').value, userPassword: document.getElementById('password').value});
                http.open("POST", url, true);

                //Send the proper header information along with the request
                http.setRequestHeader("Content-type", "application/json");

                http.onreadystatechange = function () {//Call a function when the state changes.
                    if (http.readyState == 4 && http.status == 200) {
//                        alert(JSON.stringify(http.responseText));
                        if (http.responseText != "") {
                            var arr = JSON.parse(http.responseText);

//                            alert(arr.loggedin + "Dude");
                            if (arr.loggedin == true) {
                                $('#msg').html("<h2 class='text-center'>  Hello, <i style='color: #1F968B'>"+ arr.name + "</i></h2>");

//                                modal.style.display = 'block';
                                $("#myModal").toggleClass('hidden','show');

                               //                                $('#modal').show();
//                                angular.module('HyperPerform', ['ngCookies'])
//                                        .controller('cookieCtl', ['$cookies', cookieCtl]);
//
//                                            function cookieCtl($scope, $cookies) {
//                                                $scope.setInfo = function(email) {
//                                                    $cookies.myFavorite = 'oatmeal';
//                                                    alert(email);
//                                                    alert($cookies.myFavorite);
//                                                    alert($cookies);
//                                                }
//                                        }

//                                function CookieCtrl($cookies, email, name, position ) {
//                                    $cookies.email =  email;
////                                    $cookieStore.put('name', name);
////                                    $cookieStore.put('position', position);
//                                    alert(email);
//                                    alert($cookies.email);
//                                }
//                                alert(document.cookie);
                                var cookies = document.cookie.split(";");
                                for (var i = 0; i < cookies.length; i++) {
                                    if (cookies[i].split("=")[0] == "hpkey")
                                    setCookie(cookies[i].split("=")[0], '', '', -1);
                                }
                                function setCookie(email, position, name, days) {
                                    var d = new Date();
                                    d.setTime(d.getTime() + (days*60*60*1000));
                                    var expires = "expires="+d.toUTCString();
                                    if (position == "Manager")
                                        document.cookie = "hpman="+email + "#" + position +"%" + name +"; " + expires;
                                        else
                                    document.cookie = "hpkey="+email + "#" + position +"%" + name +"; " + expires;
                                }


                                setCookie(arr.email, arr.position, arr.name, 1);
//                                alert(document.cookie);
                                setTimeout(
                                        function()
                                        {
                                            if (arr.position == "Manager")
                                                window.location.href = '/man.html';
                                                else window.location.href = '/user#/dashboard';

                                        }, 1000);

                            }
                            else {
                                document.getElementById('login').innerHTML = "Login";
                            }
                        }
                        else {
                            document.getElementById('login').innerHTML = "Login";
//                            document.getElementById('error').removeAttribute('class');
                            document.getElementById('error').innerHTML = "Error: Invalid Email or Password<br/><br/>";
                        }


                    }
                    else if (http.readyState == 1 || http.readyState == 0 || http.status == 404 || http.status == 0)
                    {
                        document.getElementById('login').innerHTML = "Login";
                        document.getElementById('error').innerHTML = "Error: Can't connect to the server <br/><br/>";

                    }

                };
                http.send(params);
            }

            function sendPass()
            {
//                alert("SEnd");
                $("#sendP").html("<i class='fa fa-spinner fa-pulse '></i>");
//                $("#valid").html("<h2 class='text-center'> An Email will be send to you shortly</h2>");
                var b = "{ ";
                b += "\"Email\": \"" + $("#mail").val();
                b += "\" }";
//                alert(JSON.stringify({ Email: $("#mail").val()}));
                $.ajax({
                    type: "POST",
                    url: "http://localhost:8080/hyperperform-system-1.0-SNAPSHOT/rs/users/forgotPassword",
                    data: JSON.stringify({ email: $("#mail").val()}),
                    headers: {"Content-Type": "application/json"}
                }).always(function(data) {
//                    alert(JSON.stringify(data));
                    if (data == null || data === undefined || data.result == undefined)
                    {
                        $('#valid').html("<h2 class='text-center'> <i style='color: red' > Error: Can't connect to the server</i></h2>");

                    }
                    else if (data.result == "Success, you will shortly receive an email")
                        $('#valid').html("<h2 class='text-center'> <i style='color: #1F968B' >"+ data.result + "</i></h2>");
                    else
                    {
                        $('#valid').html("<h2 class='text-center'> <i style='color: red'>"+ data.result + "</i></h2>");
                    }

                    // modal.style.display = 'block';
//                    if (data.result == "Success, you will shortly receive an email")
//                    {
                        setTimeout(
                                function()
                                {
                                    location.reload();

                                }, 2000);
//                    }


                });


            }

        </script>
    <!--</form>-->
    </div>
</main>
</body>
</html>